ButterQuant

## 🎯 决策流程图

```
输入股票代码
    ↓
【傅立叶变换分析】
    ├─ FFT分解价格序列
    ├─ 低频滤波 → 提取长期趋势 (>60天周期)
    ├─ 中频滤波 → 提取季节周期 (5-60天)
    └─ 功率谱分析 → 识别主要周期
    ↓
【趋势判断】
    低频斜率 > 0.1  → 上涨趋势 (UP)
    低频斜率 < -0.1 → 下跌趋势 (DOWN)
    其他            → 平稳趋势 (FLAT)
    ↓
【周期位置】
    中频平均值 > 0  → 波峰 (PEAK)
    中频平均值 < 0  → 波谷 (TROUGH)
    ↓
【策略选择】
    ┌───────────────────────────────────┐
    │ UP + TROUGH   → CALL Butterfly    │ 
    │ 上涨+波谷 → 看涨后盘整              │
    ├───────────────────────────────────┤
    │ DOWN + PEAK   → PUT Butterfly     │
    │ 下跌+波峰 → 看跌后盘整              │
    ├───────────────────────────────────┤
    │ FLAT + ANY    → IRON Butterfly    │
    │ 平稳+任意 → 双向中性盘整            │
    └───────────────────────────────────┘
```

## 🔍 关键创新点

### 1. **Call Butterfly 触发条件**
```javascript
if (trendDirection === 'UP' && cyclePosition === 'TROUGH') {
  butterflyType = 'CALL';
  // 逻辑: 
  // - 低频向上 = 大趋势看涨
  // - 中频波谷 = 短期回调到位
  // → 适合小幅上涨后盘整
}
```

**实例：** AAPL在上涨趋势中短期回调
- 低频：从$200涨到$230 ✅
- 中频：最近5天小幅回调到$225 ✅
- 策略：构建$230中心的Call Butterfly

### 2. **Put Butterfly 触发条件**
```javascript
if (trendDirection === 'DOWN' && cyclePosition === 'PEAK') {
  butterflyType = 'PUT';
  // 逻辑:
  // - 低频向下 = 大趋势看跌
  // - 中频波峰 = 短期反弹到位
  // → 适合小幅下跌后盘整
}
```

**实例：** TSLA在下跌趋势中短期反弹
- 低频：从$300跌到$250 ✅
- 中频：最近反弹到$260 ✅
- 策略：构建$250中心的Put Butterfly

### 3. **Iron Butterfly (铁蝴蝶)**
```javascript
if (trendDirection === 'FLAT') {
  butterflyType = 'IRON';
  // 逻辑:
  // - 低频平稳 = 无明确趋势
  // - 适合窄幅震荡
  // → 双向中性策略
}
```

## 📊 可视化输出

系统现在会显示：

### 1. **傅立叶分解图**
- 蓝线：原始价格
- **红线：低频趋势** (关键！判断大方向)
- **绿线：中频周期** (关键！判断波峰波谷)

### 2. **功率谱图**
显示主要交易周期，例如：
- 5天周期 (一周交易日)
- 21天周期 (一个月)
- 63天周期 (一季度)

### 3. **策略卡片**
```
┌─────────────────────────────┐
│ CALL Butterfly              │
│ 低频上涨 + 中频波谷          │
│ → 看涨后盘整                │
└─────────────────────────────┘
```

## 🎮 实际使用场景

### 场景A：科技股上涨回调
```
股票: NVDA
当前: $140
低频: 从$100涨到$145 (上涨趋势)
中频: 最近3天从$145回调到$140 (波谷)

系统判断:
✅ CALL Butterfly
中心行权价: $145
预期: 回到$145后盘整

操作:
买 1份 $140 Call
卖 2份 $145 Call
买 1份 $150 Call
```

### 场景B：指数下跌反弹
```
股票: SPY
当前: $580
低频: 从$600跌到$575 (下跌趋势)
中频: 最近反弹到$580 (波峰)

系统判断:
✅ PUT Butterfly
中心行权价: $575
预期: 回落到$575后盘整

操作:
买 1份 $570 Put
卖 2份 $575 Put
买 1份 $580 Put
```

### 场景C：横盘震荡
```
股票: GOOG
当前: $185
低频: 过去2个月在$180-$190震荡 (平稳)
中频: 无明显周期

系统判断:
✅ IRON Butterfly
中心行权价: $185
预期: 继续窄幅震荡

操作:
卖 1份 $185 Call
卖 1份 $185 Put
买 1份 $190 Call
买 1份 $180 Put
```

## ⚡ 优势总结

### 传统ARIMA-GARCH的问题
```
❌ 只能判断价格会不会稳定
❌ 无法判断方向 (涨后盘整 vs 跌后盘整)
❌ 无法识别周期性机会
```

### 加入傅立叶变换后
```
✅ 低频成分 → 判断大趋势方向
✅ 中频周期 → 找最佳入场时机
✅ 功率谱 → 发现隐藏的交易周期
✅ 自动选择 Call/Put/Iron → 提高胜率
```

## 🚀 立即试用

试试这些经典场景：

1. **上涨股票** → `AAPL`, `MSFT` (可能是Call Butterfly)
2. **下跌股票** → 找最近跌幅较大的
3. **横盘ETF** → `SPY`, `QQQ` (可能是Iron Butterfly)

系统会自动：
- 分解价格序列
- 识别主要周期
- 判断趋势+周期位置
- 推荐最佳策略类型
- 计算具体行权价和成本

